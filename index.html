<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Kevin Bacon</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css">
    <style type="text/css">
    	#accordion { width: 450px; }
    	h3 { margin-top: 40px; }
      ul { list-style: none; }
      .portrait { width: 32px; border-radius: 50%; margin-right: 5px; }
      li { margin-bottom: 5px; }
      .results { display: none; }
      .page { width: 600px; margin: auto; }
    </style>
  </head>
  <body>

    <div class="container page">
    	<center>
	    	<img src="banner.jpg">
	      <h1>Six Degrees from Kevin Bacon</h1>
    	</center>
      <p>How many degrees are you from <a href="http://www.baconbros.com/" target="_blank">Kevin Bacon</a>? This is based on the game of Six Degrees of Separation, the idea that all living things and everything else in the world are six or fewer steps away from each other so that a chain of "a friend of a friend" statements can be made to connect any two people in a maximum of six steps. It was originally set out by <a href="https://en.wikipedia.org/wiki/Frigyes_Karinthy" target="_blank">Frigyes Karinthy</a> in 1929.</p>

      <!-- Login -->
      <div class="auth text-center">
        <button class="login btn btn-primary">Login</button>
      </div>

      <!-- Show Results -->
      <div class="results">
        <h3>Bacon Number: <span class="number"></span></h3>
        <strong>Your relationship with Kevin Bacon</strong>
  	    <div><ul class="path"></ul></div>
      </div>

    </div>

    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/fs-js-lite@latest/dist/FamilySearch.min.js"></script>

    <script type="text/javascript">
      var fs = new FamilySearch({
        environment: 'production',
        appKey: 'a02j000000KTRjpAAH',
        redirectUri: 'https://misbach.github.io/fs-kevinbacon/'
      });
      let bacons = { "L2N8-NL6": {}, "L2N8-NR7": {} };
      let length = 99;

      // Login
      $('.login').click(function() { fs.oauthRedirect() })

      // Finish oauth and get relationships
      fs.oauthResponse(function() {
        $('.results').show();
        $('.auth').hide();

        Object.keys(bacons).forEach(function(key,index) {
          fs.get("/platform/tree/my-relationships?personDetails=true&pid="+key, 
            function(err, rsp) {
              console.log(rsp.data);
              // Display the shortest path
              if (rsp.data.persons.length < length) {
                $('.path').empty();
                length = rsp.data.persons.length;
                $('.number').text(length);

                // Display relationship path
                for (var i=0; i<rsp.data.persons.length; i++) {
                  $('.path').append('<li><img class="portrait" src="https://api.familysearch.org/platform/tree/persons/'+rsp.data.persons[i].id+'/portrait?default=https://fsicons.org/wp-content/uploads/2014/10/gender-unknown-x-large.png"><a href="https://www.familysearch.org/tree/person/'+rsp.data.persons[i].id+'" target="_blank">'+rsp.data.persons[i].display.name+'</a></li>');
                }
                // Display Kevin
                $('.path').append('<li><img class="portrait" src="icon.jpg">Kevin Bacon</li>');
              }
          });
        });
      });
    </script>
  </body>
</html>