<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Don Benito Pablo Juarez García</title>
    <style type="text/css">
    	h3 { margin-top: 40px; margin-bottom: 40px; }
      ul { list-style: none; }
      .portrait { width: 32px; border-radius: 50%; margin-right: 5px; vertical-align: middle; }
      li { margin-bottom: 5px; }
      .page { width: 600px; margin: auto; }
      body { font-size: 18px; font-family: "Helvetica Neue",Arial,sans-serif; }
    </style>
  </head>
  <body>

    <div class="container page">
    	<center>
	      <h1>Don Benito Pablo Juarez García</h1>
    	</center>
      <p>How are you related to <a href="https://en.wikipedia.org/wiki/Benito_Ju%C3%A1rez" target="_blank">Don Benito Pablo Juarez García</a>?</p>

      <!-- Show Results -->
      <div class="results">
        <h3>Distance: <span id="number"></span></h3>
        <strong>Your relationship</strong>
  	    <div><ul id="path"></ul></div>
      </div>
    </div>

    <script src="https://unpkg.com/fs-js-lite@latest/dist/FamilySearch.min.js"></script>
    <script type="text/javascript">
      var fs = new FamilySearch({
        environment: 'production',
        appKey: 'a02j000000KTRjpAAH',
        saveAccessToken: true,
        redirectUri: 'https://misbach.github.io/fs-kevinbacon/benito.html'
        // redirectUri: 'http://localhost:5000'
      });

      // Auto-login: Handle an OAuth2 state
      var oauthResponseState = fs.oauthResponse(function(error, response) {
        if (response.statusCode === 200) window.location = window.location.pathname;
      });
      // Login if not authenticated
      if (!oauthResponseState && !fs.getAccessToken()) fs.oauthRedirect();
      else {
        fs.get("/platform/users/current", function(error, response) {
          if (response.statusCode == 401) fs.oauthRedirect();
          getRelationships();
        });
      }

      // Get relationships
      function getRelationships() {        
        fs.get("/platform/tree/my-relationships?pid=9MJP-SXF", 
          function(err, rsp) {
            // Are you related?
            if (rsp.data) {
              length = rsp.data.persons.length;
              document.getElementById('path').innerHTML = "";
              document.getElementById('number').innerHTML = length;

              // Display relationship path
              for (var i=0; i<rsp.data.persons.length; i++) {
                let li = document.createElement("li");
                let token = '&access_token='+fs.accessToken;
                li.innerHTML = '<li><img class="portrait" src="https://api.familysearch.org/platform/tree/persons/'+rsp.data.persons[i].id+'/portrait?default=https://misbach.github.io/fs-kevinbacon/person.png'+token+'"><a href="https://www.familysearch.org/tree/person/'+rsp.data.persons[i].id+'" target="_blank">'+rsp.data.persons[i].display.name+'</a></li>';
                document.getElementById("path").appendChild(li);
              }
            } else {
              // Not Related
              alert("Sorry, you are not related");
            }
        });
      }
    </script>
  </body>
</html>